@using ElectronicDeviceShop.ViewModels.Accounts
@model AccountDetailViewModel

@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<section class="banner_area shadow">
    <div class="banner_inner d-flex align-items-center ">
        <div class="container">
            <div class="banner_content d-md-flex justify-content-between align-items-center">
                <div class="mb-3 mb-md-0">
                    <h2>Tài khoản</h2>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="product_description_area pt-5 pb-0">
    <ul class="nav nav-tabs bg-white" id="myTab" role="tablist">
        <li class="nav-item shadow-sm active show">
            <a class="nav-link active show" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="false">Hồ sơ</a>
        </li>
        <li class="nav-item shadow-sm">
            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Đơn mua</a>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane active show" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="p-5 p-5" style="background-color:white">
                <div class="container rounded bg-white shadow p-3 mb-5 bg-white rounded">
                    <div class="row">
                        <div class="col-md-3 border-right">
                            <div class="d-flex flex-column align-items-center text-center p-3 py-5">

                                <label for="Avatar" style="cursor: pointer;">
                                    @{
                                        if (Model.Avatar != null)
                                        {
                                            <img class="rounded-circle mt-5 shadow" id="imgPreview" height="120px" width="120px" src="/wwwroot/ImageProducts/@Model.Avatar">
                                        }
                                        else
                                        {
                                            <img class="rounded-circle mt-5 shadow" id="imgPreview" height="120px" width="120px" src="/wwwroot/ImageProducts/no-image-icon-0.jpg">
                                        }
                                    }
                                </label>
                                <input type="file" id="Avatar" style="opacity: 0; position: absolute; z-index: -1;" />
                                <br />
                                <span class="font-weight-bold" id="UserName">@Model.UserName</span>
                                <span class="text-black-50"></span>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button class="btn btn-primary profile-button" type="button" onclick="Logout();">Đăng xuất</button>
                            </div>
                        </div>
                        <div class="col-md-5 border-right">
                            <div class="p-3 py-5">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="text-right">Hồ sơ</h4>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label class="labels">Họ và tên</label>
                                        <input type="text" class="form-control" id="FullName" placeholder="" value="@Model.FullName">
                                        <div class="valid-feedback" id="error_fullName"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="labels">Số điện thoại</label>
                                        <input type="text" class="form-control" id="Phone" placeholder="" value="@Model.Phone">
                                        <div class="valid-feedback " id="error_phone"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="labels">Địa chỉ</label>
                                        <input type="text" class="form-control" id="Address" placeholder="" value="@Model.Address">
                                        <div class="valid-feedback " id="error_address"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="labels">Email</label>
                                        <input type="text" class="form-control" id="Email" placeholder="" value="@Model.Email">
                                        <div class="valid-feedback " id="error_email"></div>
                                    </div>
                                </div>
                                <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="button" onclick="Edit();">Lưu</button></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 py-5">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="text-right">Đổi mật khẩu</h4>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label class="labels">Mật khẩu cũ</label>
                                        <input type="text" class="form-control" id="oldPass" placeholder="" value="">
                                        <div class="valid-feedback" id="error_oldPass"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="labels">Mật khẩu mới</label>
                                        <input type="text" class="form-control" id="newPass" placeholder="" value="">
                                        <div class="valid-feedback " id="error_newPass"></div>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="labels">Xác minh mật khẩu</label>
                                        <input type="text" class="form-control" id="confirmPass" placeholder="" value="">
                                        <div class="valid-feedback " id="error_confirmPass"></div>
                                    </div>
                                </div>
                                <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="button" onclick="ChangePass();">Đổi mật khẩu</button></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="row">
                <div class="col">
                    <div class="card card-small mb-4 mt-5 shadow-lg rounded">
                        <div class="card-body p-0 text-center align-middle table-responsive-sm ">
                            <!-- partial:index.partial.html -->
                            <div class="tabs-to-dropdown">
                                <div class="nav-wrapper d-flex justify-content-center">
                                    <ul class="nav nav-pills d-none d-md-flex" id="pills-tab" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link active" id="pills-new-orders-tab" data-toggle="pill" href="#pills-new-orders" onclick="tab = 1; LoadData(null, 1);" role="tab" aria-controls="pills-new-orders" aria-selected="true">Đơn hàng mới</a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" id="pills-confirm-orders-tab" data-toggle="pill" href="#pills-confirm-orders" onclick="tab = 2; LoadData(null,1);" role="tab" aria-controls="pills-confirm-orders" aria-selected="false">Đơn hàng đã tiếp nhận</a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" id="pills-shipping-orders-tab" data-toggle="pill" href="#pills-shipping-orders" onclick="tab = 3; LoadData(null,1);" role="tab" aria-controls="pills-shipping-orders" aria-selected="false">Đơn hàng đang vận chuyển</a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" id="pills-success-orders-tab" data-toggle="pill" href="#pills-success-orders" onclick="tab = 4; LoadData(null,1);" role="tab" aria-controls="pills-success-orders" aria-selected="false">Đơn hàng đã giao thành công</a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" id="pills-cancel-orders-tab" data-toggle="pill" href="#pills-cancel-orders" onclick="tab = 5; LoadData(null,1);" role="tab" aria-controls="pills-cancel-orders" aria-selected="false">Đơn hàng đã hủy</a>
                                        </li>
                                    </ul>
                                </div>

                                <div class="tab-content" id="pills-tabContent">
                                    <div class="tab-pane fade show active" id="pills-new-orders" role="tabpanel" aria-labelledby="pills-new-orders-tab">
                                        <div class="">
                                            <div class="input-group mb-3 col-12">
                                                <div class="input-group input-group-seamless">
                                                    <span class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="fas fa-search"></i>
                                                        </span>
                                                    </span>
                                                    <input type="text" class="form-control" id="txtSearch" placeholder="Tìm kiếm" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                                </div>
                                            </div>
                                            <!-- Default Light Table -->
                                            <div class="row">
                                                <div class="col">
                                                    <div>
                                                        <div class="card-body p-0 text-center align-middle table-responsive-lg">
                                                            <table class="table mb-0 ">
                                                                <thead class="bg-light ">
                                                                    <tr>
                                                                        <th class="border-0">#</th>
                                                                        <th class="border-0">Người nhận</th>
                                                                        <th class="border-0">Địa chỉ nhận</th>
                                                                        <th class="border-0">Hình thức thaanh toán</th>
                                                                        <th class="border-0">Ngày mua</th>
                                                                        <th class="border-0">Chức năng</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody class="tbody-light">
                                                                    @*DATA*@
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="card-footer col no-gutters py-4 d-flex flex-column text-center fw-bold col-12 border-top">
                                                            <div class="dataTables_info" id="dt-material-checkbox_info" role="status" aria-live="polite">Showing 1 to 10 of 57 entries</div>
                                                            <div class="dataTables_paginate paging_simple_numbers d-flex justify-content-center" id="dt-material-checkbox_paginate">
                                                                <ul class="pagination">
                                                                    @*PAGINATION*@
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- End Default Light Table -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
@section modal{
    <div class="modal" id="modal-detail" tabindex="-1 " role="dialog" aria-labelledby="mediumModalLabel " aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
            <div class="modal-content ">
                <div class="modal-header p-3">
                    <div class="col-10 border-bottom-0 ">
                        <h3 class="page-title">
                            Chi tiết Đơn hàng
                            <small class="page-info">
                                <i class="fa fa-angle-double-right text-80"></i>
                                ID: #<span id="id-detail"></span>
                            </small>
                            <img class="" alt="" style="height: 50px;">
                        </h3>
                    </div>
                    <button type="button" class="close btn-lg" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body p-3 d-flex flex-column">
                    <div class="card-body p-0">
                        <div class="page-content container col-12 m-1 d-flex justify-content-center">
                            <div class="container px-0">
                                <div class="row">
                                    <div class="col-12 col-lg-10 offset-lg-1">
                                        <div class="row col-12 m-0">
                                            <div class="col-4">
                                                <div>
                                                    <span class="text-sm text-grey-m2 align-middle">Người nhận:</span>
                                                    <span class="text-600 text-110 text-blue align-middle" id="name-detail">Alex Doe</span>
                                                </div>
                                                <div class="text-grey-m2">
                                                    <div class="my-1" style="word-break:break-word" id="address-detail">
                                                        Street, City
                                                    </div>
                                                    <div class="my-1"><i class="fa fa-phone fa-flip-horizontal text-secondary"></i> <b class="text-600" id="phone-detail">111-111-111</b></div>
                                                </div>
                                            </div>
                                            <!-- /.col -->

                                            <div class="col-4">
                                                <div class="text-grey-m2">
                                                    <div class="mt-1 mb-2 text-secondary-m1 text-600 text-125">
                                                        Chi tiết
                                                    </div>
                                                    <div class="my-2"><i class="fa fa-circle text-blue-m2 text-xs mr-1"></i> <span class="text-600 text-90">Thanh toán:</span> <span id="payType-detail">Unpaid</span></div>
                                                    <div class="my-2"><i class="fa fa-circle text-blue-m2 text-xs mr-1"></i> <span class="text-600 text-90">Trạng thái:</span> <span class="badge badge-warning badge-pill px-25" id="status-detail">Unpaid</span></div>
                                                </div>
                                            </div>
                                            <!-- /.col -->
                                            <div class="col-4">
                                                <div class="text-grey-m2">
                                                    <div class="mt-1 mb-2 text-secondary-m1 text-600 text-125">
                                                        Ghi chú
                                                    </div>
                                                    <div class="my-2"><i class="fa fa-circle text-blue-m2 text-xs mr-1"></i><span id="note-detail"></span></div>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="mt-4">
                                            <div class="row text-600 text-black bgc-default-tp1 py-25">
                                                <div class="d-none d-sm-block col-1">#</div>
                                                <div class="col-9 col-sm-5">Tên sản phẩm</div>
                                                <div class="d-none d-sm-block col-4 col-sm-2">Số lượng</div>
                                                <div class="d-none d-sm-block col-sm-2">Đơn giá</div>
                                                <div class="col-2">Tổng</div>
                                            </div>

                                            <div class="text-95 text-secondary-d3" id="product-detail">
                                                @*Product*@
                                            </div>
                                            <div class="row border-b-2 brc-default-l2"></div>

                                            <div class="row mt-3">
                                                <div class="col-12 col-sm-7 text-grey-d2 text-95 mt-2 mt-lg-0">

                                                </div>

                                                <div class="col-12 col-sm-5 text-grey text-90 order-first order-sm-last">
                                                    <div class="row my-2">
                                                        <div class="col-7 text-right">
                                                            Thành tiền
                                                        </div>
                                                        <div class="col-5">
                                                            <span class="text-120 text-secondary-d1" id="totalMoney">$2,250</span>
                                                        </div>
                                                    </div>

                                                    @*<div class="row my-2">
                                                            <div class="col-7 text-right">
                                                                Giảm giá (<span id="discount-detail"></span>
                                                            </div>
                                                            <div class="col-5">
                                                                <span class="text-110 text-secondary-d1" id="totalMoneyDiscount">$225</span>
                                                            </div>
                                                        </div>
                                                        <div class="row my-2 align-items-center bgc-primary-l3 p-2">
                                                            <div class="col-7 text-right">
                                                                Thành tiền
                                                            </div>
                                                            <div class="col-5">
                                                                <span class="text-150 text-success-d3 opacity-2"  id="totalMoneyDiscount">$2,475</span>
                                                            </div>
                                                        </div>*@
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class=" btn btn-danger btn-lg me-md-2" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    @*CANCEL*@
    <div class="modal" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Hủy đơn hàng</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Bạn có muốn hủy đơn hàng này không?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Không</button>
                    <button type="button" class="btn btn-success" onclick="Cancel(idBill);" data-bs-dismiss="modal">Có</button>
                </div>
            </div>
        </div>
    </div>
}

@section Script{
    <script>
        var lastPage = 1;
        var pageCurrent = 1;
        let tab = 1;
        let money = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'VND' });
        let idBill = 0;
        function Logout() {
            $.ajax({
                url: '/Account/Logout',
                type: "POST",
                success: function (result) {
                    window.location.href = "/Account/Index";
                },
                error: function (err) {
                    return false;
                }
            });
        }
        $(document).ready(function () {
            LoadNewOrder(null, 1);
            $("body").on("click", ".pagination li a", function (event) {
                event.preventDefault();
                var page = $(this).attr('data-page');
                Search(page);
            });
        });
        function LoadAcount() {
            id = @Session["ID_Account"];
            ClearValidation();
            $.ajax({
                url: "/Account/GetById/" + id,
                typr: "GET",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (result) {
                    $('#FullName').val(result.FullName);
                    $('#Phone').val(result.Phone);
                    $('#Address').val(result.Address);
                    $('#Email').val(result.Email);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });
            return false;
        }
        function UploadImage() {
            // Checking whether FormData is available in browser
            if (window.FormData !== undefined) {

                var fileUpload = $("#Avatar").get(0);
                var files = fileUpload.files;

                // Create FormData object
                var fileData = new FormData();

                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                }

                $.ajax({
                    url: '/Account/UploadFiles',
                    type: "POST",
                    contentType: false, // Not to set any content header
                    processData: false, // Not to process data
                    data: fileData,
                    success: function (result) {
                        return true;
                    },
                    error: function (err) {
                        return false;
                    }
                });
            } else {
                return false;
            }
        }
        function GetImage() {
            var fileUpload = $("#Avatar").get(0);
            var files = fileUpload.files;

            // Create FormData object
            var fileData = new FormData();

            // Looping over all files and add it to FormData object
            for (var i = 0; i < files.length; i++) {
                fileData.append(i, files[i].name);
            }
            return fileData;
        }
        function Edit() {
            errorPhone();
            errorEmail();
            if (checkError)
                return;

            var fileData = GetImage();
            let account = {};
            account["ID_Account"] =@Session["ID_Account"];
            account["UserName"] = $('#UserName').text();
            account["FullName"] = $('#FullName').val();
            account["Phone"] = $('#Phone').val();
            account["Address"] = $('#Address').val();
            account["Email"] = $('#Email').val();
            if ($("#Avatar").get(0).files.length != 0)
                account["Avatar"] = fileData.get(0);
            else
                account["Avatar"] = $("#imgPreview").attr('src').split('/')[3];

            $.ajax({
                url: "/Account/Edit",
                data: JSON.stringify(account),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result) {
                        UploadImage();
                        ClearTextBox();
                        LoadAcount();
                        toastr.success('Lưu thành công!');
                    }
                    else {
                        toastr.error('Lưu không thành công!');
                    }
                },
                error: function (errormessage) {
                    toastr.error('Lưu không thành công!');
                }
            });
        }
        function ChangePass() {
            errorOldPass();
            errorNewPass();
            errorConfirmPass();

            let account = {};
            account["Password"] = $("#newPass").val();

            $.ajax({
                url: "/Account/ChangePass",
                data: JSON.stringify(account),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result) {
                        UploadImage();
                        ClearTextBox();
                        LoadAcount();
                        toastr.success('Đổi mật khẩu thành công!');
                    }
                    else {
                        toastr.error('Đổi mật khẩu không thành công!');
                    }
                },
                error: function (errormessage) {
                    toastr.error('Đổi mật khẩu không thành công!');
                }
            });
        }
        function CheckPassword() {
            let account = {};
            account["ID_Account"] = @Session["ID_Account"];
            account["Password"] = $('#oldPass').val();
            account["Role"] = 2;
            account["Status"] = 1;

            $.ajax({
                url: "/Account/CheckPassword",
                data: JSON.stringify(account),
                type: "POST",
                processData: false,
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (result) {
                    if (result) {
                        $('#error_oldPass').hide();
                        $('#oldPass').addClass('is-valid');
                        $('#oldPass').removeClass('is-invalid');
                        checkError = false;
                    }
                    else {
                        $('#error_oldPass').show();
                        $('#error_oldPass').addClass('invalid-feedback');
                        $('#error_oldPass').removeClass('valid-feedback');
                        $('#oldPass').addClass('is-invalid');
                        $('#error_oldPass').text("Mật khẩu cũ không đúng!");
                        checkError = true;
                    }
                },
                error: function (errormessage) {
                    $('#error_oldPass').show();
                    $('#error_oldPass').addClass('invalid-feedback');
                    $('#error_oldPass').removeClass('valid-feedback');
                    $('#oldPass').addClass('is-invalid');
                    $('#error_oldPass').text("Mật khẩu cũ không đúng!");
                    checkError = true;
                }
            });
        }
        function ClearTextBox() {

            $('#oldPass').val('');
            $('#newPass').val('');
            $('#confirmPass').val('');

            ClearValidation();
        }
        function ClearValidation() {
            $('#oldPass').removeClass('is-invalid');
            $('#oldPass').removeClass('is-valid');
            $('#newPass').removeClass('is-invalid');
            $('#newPass').removeClass('is-valid');
            $('#confirmPass').removeClass('is-invalid');
            $('#confirmPass').removeClass('is-valid');
            $('#Avatar').removeClass('is-invalid');
            $('#Avatar').removeClass('is-valid');
            $('#error_userName').hide();
            $('#error_avatar').hide();
        }
        function convertToJavaScriptDate(value) {
            var pattern = /Date\(([^)]+)\)/;
            var results = pattern.exec(value);
            var dt = new Date(parseFloat(results[1]));
            return (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear();
        }
        function LoadData(txtSearch, page) {
            switch (tab) {
                case 1:
                    LoadNewOrder(txtSearch, page);
                    break;
                case 2:
                    LoadConfirmOrder(txtSearch, page);
                    break;
                case 3:
                    LoadShippingOrder(txtSearch, page);
                    break;
                case 4:
                    LoadSuccessOrder(txtSearch, page);
                    break;
                case 5:
                    LoadCancelOrder(txtSearch, page);
                    break;
            }
        }
        function LoadNewOrder(txtSearch, page) {
            $.ajax({
                url: "/Account/GetNewOrder",
                type: "GET",
                data: { txtSearch: txtSearch, page: page },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    ClearZone();
                    var count = 0;
                    var html = '';
                    $.each(result.data, function (key, item) {
                        count++;
                        html += '<tr>';
                        html += '<td class="align-middle p-2">' + ((result.pageCurrent - 1) * result.pageSize + count) + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverName + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverAddress + '</td>';
                        html += '<td class="align-middle p-2">' + item.PayType + '</td>';
                        html += '<td class="align-middle p-2">' + convertToJavaScriptDate(item.BuyDate) + '</td>';
                        html += '<td class="align-middle p-2 d-flex justify-content-center">';
                        html += '<button type="button" class="col-4 btn btn-lg btn-danger m-1 d-flex justify-content-center align-items-center" onclick="idBill = ' + item.ID_Bill + '" data-bs-toggle="modal" data-bs-target="#confirmModal"><i class="fas fa-times "></i></button>';
                        html += '<button type="button" class="col-4 btn btn-lg btn-info m-1 d-flex justify-content-center align-items-center"  onclick="Detail(' + item.ID_Bill + ');" data-bs-toggle="modal" data-bs-target="#modal-detail"><i class="fas fa-eye "></i></button>';
                        html += ' </td >';
                        html += '</tr>';
                    });
                    $('.tbody-light').html(html);

                    //create pagination
                    var pagination_string = "";
                    pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    lastPage = numSize;

                    $('#dt-material-checkbox_info').text(result.data.length + '/' + result.all.length);

                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }

                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    $(".pagination").html(pagination_string);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });

        }
        function LoadConfirmOrder(txtSearch, page) {
            $.ajax({
                url: "/Account/GetConfirmOrder",
                type: "GET",
                data: { txtSearch: txtSearch, page: page },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    ClearZone();
                    var count = 0;
                    var html = '';
                    $.each(result.data, function (key, item) {
                        count++;
                        html += '<tr>';
                        html += '<td class="align-middle p-2">' + ((result.pageCurrent - 1) * result.pageSize + count) + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverName + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverAddress + '</td>';
                        html += '<td class="align-middle p-2">' + item.PayType + '</td>';
                        html += '<td class="align-middle p-2">' + convertToJavaScriptDate(item.BuyDate) + '</td>';
                        html += '<td class="align-middle p-2 d-flex justify-content-center">';
                        html += '<button type="button" class="col-4 btn btn-lg btn-danger m-1 d-flex justify-content-center align-items-center" onclick="idBill = ' + item.ID_Bill + '" data-bs-toggle="modal" data-bs-target="#confirmModal"><i class="fas fa-times "></i></button>';
                        html += '<button type="button" class="col-4 btn btn-sm btn-info m-1 d-flex justify-content-center align-items-center"  onclick="Detail(' + item.ID_Bill + ');" data-bs-toggle="modal" data-bs-target="#modal-detail"><i class="fas fa-eye "></i></button>';
                        html += ' </td >';
                        html += '</tr>';
                    });
                    $('.tbody-light').html(html);

                    //create pagination
                    var pagination_string = "";
                    pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    lastPage = numSize;

                    $('#dt-material-checkbox_info').text(result.data.length + '/' + result.all.length);

                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }

                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    $(".pagination").html(pagination_string);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });

        }
        function LoadShippingOrder(txtSearch, page) {
            $.ajax({
                url: "/Account/GetShippingOrder",
                type: "GET",
                data: { txtSearch: txtSearch, page: page },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    ClearZone();
                    var count = 0;
                    var html = '';
                    $.each(result.data, function (key, item) {
                        count++;
                        html += '<tr>';
                        html += '<td class="align-middle p-2">' + ((result.pageCurrent - 1) * result.pageSize + count) + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverName + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverAddress + '</td>';
                        html += '<td class="align-middle p-2">' + item.PayType + '</td>';
                        html += '<td class="align-middle p-2">' + convertToJavaScriptDate(item.BuyDate) + '</td>';
                        html += '<td class="align-middle p-2 d-flex justify-content-center">';
                        html += '<button type="button" class="col-4 btn btn-lg btn-danger m-1 d-flex justify-content-center align-items-center" onclick="idBill = ' + item.ID_Bill + '" data-bs-toggle="modal" data-bs-target="#confirmModal"><i class="fas fa-times "></i></button>';
                        html += '<button type="button" class="col-4 btn btn-sm btn-info m-1 d-flex justify-content-center align-items-center"  onclick="Detail(' + item.ID_Bill + ');" data-bs-toggle="modal" data-bs-target="#modal-detail"><i class="fas fa-eye "></i></button>';
                        html += ' </td >';
                        html += '</tr>';
                    });
                    $('.tbody-light').html(html);

                    //create pagination
                    var pagination_string = "";
                    pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    lastPage = numSize;

                    $('#dt-material-checkbox_info').text(result.data.length + '/' + result.all.length);

                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }

                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    $(".pagination").html(pagination_string);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });

        }
        function LoadSuccessOrder(txtSearch, page) {
            $.ajax({
                url: "/Account/GetSuccessOrder",
                type: "GET",
                data: { txtSearch: txtSearch, page: page },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    ClearZone();
                    var count = 0;
                    var html = '';
                    $.each(result.data, function (key, item) {
                        count++;
                        html += '<tr>';
                        html += '<td class="align-middle p-2">' + ((result.pageCurrent - 1) * result.pageSize + count) + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverName + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverAddress + '</td>';
                        html += '<td class="align-middle p-2">' + item.PayType + '</td>';
                        html += '<td class="align-middle p-2">' + convertToJavaScriptDate(item.BuyDate) + '</td>';
                        html += '<td class="align-middle p-2 d-flex justify-content-center">';
                        html += '<button type="button" class="col-4 btn btn-sm btn-info m-1 d-flex justify-content-center align-items-center"  onclick="Detail(' + item.ID_Bill + ');" data-bs-toggle="modal" data-bs-target="#modal-detail"><i class="fas fa-eye "></i></button>';
                        html += ' </td >';
                        html += '</tr>';
                    });
                    $('.tbody-light').html(html);

                    //create pagination
                    var pagination_string = "";
                    pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    lastPage = numSize;

                    $('#dt-material-checkbox_info').text(result.data.length + '/' + result.all.length);

                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }

                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    $(".pagination").html(pagination_string);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });

        }
        function LoadCancelOrder(txtSearch, page) {
            $.ajax({
                url: "/Account/GetCancelOrder",
                type: "GET",
                data: { txtSearch: txtSearch, page: page },
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    ClearZone();
                    var count = 0;
                    var html = '';
                    $.each(result.data, function (key, item) {
                        count++;
                        html += '<tr>';
                        html += '<td class="align-middle p-2">' + ((result.pageCurrent - 1) * result.pageSize + count) + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverName + '</td>';
                        html += '<td class="align-middle p-2">' + item.ReceiverAddress + '</td>';
                        html += '<td class="align-middle p-2">' + item.PayType + '</td>';
                        html += '<td class="align-middle p-2">' + convertToJavaScriptDate(item.BuyDate) + '</td>';
                        html += '<td class="align-middle p-2 d-flex justify-content-center">';
                        html += '<button type="button" class="col-4 btn btn-sm btn-info m-1 d-flex justify-content-center align-items-center"  onclick="Detail(' + item.ID_Bill + ');" data-bs-toggle="modal" data-bs-target="#modal-detail"><i class="fas fa-eye "></i></button>';
                        html += '</td>';
                        html += '</tr>';
                    });
                    $('.tbody-light').html(html);

                    //create pagination
                    var pagination_string = "";
                    pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    lastPage = numSize;

                    $('#dt-material-checkbox_info').text(result.data.length + '/' + result.all.length);

                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }

                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }

                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    $(".pagination").html(pagination_string);
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });

        }
        function Detail(ID) {
            $.ajax({
                url: "/Account/GetBillById/" + ID,
                typr: "GET",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (result) {
                    $('#id-detail').text(result.bill.ID_Bill);
                    $('#name-detail').text(result.bill.ReceiverName);
                    $('#address-detail').text(result.bill.ReceiverAddress);
                    $('#phone-detail').text(result.bill.ReceiverPhone);
                    var status = "";
                    switch (result.bill.Status) {
                        case 2:
                            status = "Đơn mới";
                            break;
                        case 3:
                            status = "Đã tiếp nhận";
                            break;
                        case 4:
                            status = "Đang vận chuyển";
                            break;
                        case 5:
                            status = "Giao thành công";
                            break;
                        case 6:
                            status = "Đã hủy";
                            break;
                    }
                    $('#status-detail').text(status);
                    $('#payType-detail').text(result.bill.PayType);
                    $('#note-detail').text(result.bill.Note);
                    var html = '';
                    var count = 0;
                    var totalMoney = 0;
                    $.each(result.product, function (key, item) {
                        count++;
                        html += '<div class="row mb-2 mb-sm-0 py-25">';
                        html += '<div class="d-none d-sm-block col-1">' + count + '</div>';
                        html += '<div class="col-9 col-sm-5">' + item.Name + '</div>';
                        html += '<div class="d-none d-sm-block col-2">' + result.billDetail[count - 1].Amount + '</div>';
                        html += '<div class="d-none d-sm-block col-2 text-95">' + money.format(result.billDetail[count - 1].CurrentlyPrice / result.billDetail[count - 1].Amount ) + '</div>';
                        html += '<div class="col-2 text-secondary-d2">' + money.format(result.billDetail[count - 1].CurrentlyPrice) + '</div>';
                        html += '</div>';
                        html += '<hr />';
                        totalMoney += result.billDetail[count - 1].CurrentlyPrice;
                    });
                    $('#product-detail').html(html);
                    $('#totalMoney').text(money.format(totalMoney));
                },
                error: function (errormessage) {
                    toastr.error(errormessage.responseText);
                }
            });
        }
        let id = 0;
        var select;
        function Cancel() {
            let bill = {};

            bill["ID_Bill"] = idBill;
            //bill["ReceiverName"] = getBill.ReceiverName;
            //bill["ID_Account"] = getBill.ID_Account;
            //bill["ReceiverAddress"] = getBill.ReceiverAddress;
            //bill["ReceiverEmail"] = getBill.ReceiverEmail;
            //bill["ReceiverPhone"] = getBill.ReceiverPhone;
            //bill["PayType"] = getBill.PayType;
            //bill["Note"] = getBill.Note;
            //bill["PayType"] = getBill.PayType;
            //bill["BuyDate"] = convertToJavaScriptDate(getBill.BuyDate);
            bill["Status"] = 6;

            $.ajax({
                url: "/Account/CancelBill",
                data: JSON.stringify(bill),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    Search(pageCurrent);
                    toastr.success('Hủy thành công!');
                },
                error: function (errormessage) {
                    toastr.error('Hủy không thành công!');
                }
            });
        }
        function ClearZone() {
            $(".tbody-light").empty();
            $(".pagination").empty();
        }
        const Search = (page) => {
            var txtSearch = $("#txtSearch").val();
            if (txtSearch != "") {
                LoadData(txtSearch, page);
            }
            else {
                LoadData(null, page);
            }
        }
        $('#txtSearch').keyup(() => {
            Search(1);
        });
        $('#txtSearch').keydown(() => {
            Search(1);
        });
        $('#Avatar').change(function () {
            const [file] = $('#Avatar').get(0).files;
            if (file) {
                imgPreview.src = URL.createObjectURL(file);
            } else {
                imgPreview.src = '/wwwroot/ImageProducts/no-image-icon-0.jpg';
            }
            errorAvatar();
        });
        //Validations
        let passwordRegex = /^\w.{8,}$/;
        let phoneRegex = /^[0-9]{10}$/;
        let emailRegex = /^(([^<>()[\]\\.,;:\s@@"]+(\.[^<>()[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

        let checkError = false;
        const errorConfirmPass = () => {
            if ($('#confirmPass').val() != $('#newPass').val()) {
                $('#error_confirmPass').show();
                $('#error_confirmPass').addClass('invalid-feedback');
                $('#error_confirmPass').removeClass('valid-feedback');
                $('#confirmPass').addClass('is-invalid');
                $('#error_confirmPass').text("Mật khẩu không trùng khớp!");
                checkError = true;
            }
            else {
                $('#error_confirmPass').hide();
                $('#confirmPass').addClass('is-valid');
                $('#confirmPass').removeClass('is-invalid');
                checkError = false;
            }
        }
        $('#confirmPass').keyup(() => {
            errorConfirmPass();
        });
        $('#confirmPass').keydown(() => {
            errorConfirmPass();
        });
        const errorNewPass = () => {
            if ($('#newPass').val() == '') {
                $('#error_newPass').show();
                $('#error_newPass').addClass('invalid-feedback');
                $('#error_newPass').removeClass('valid-feedback');
                $('#newPass').addClass('is-invalid');
                $('#error_newPass').text("Mật khẩu mới không được để trống!");
                checkError = true;
            }
            else if ($('#newPass').val().length < 8) {
                $('#error_newPass').show();
                $('#error_newPass').addClass('invalid-feedback');
                $('#error_newPass').removeClass('valid-feedback');
                $('#newPass').addClass('is-invalid');
                $('#error_newPass').text("Mật khẩu mới dài hơn 8 kí tự!");
                checkError = true;
            }
            else if (!passwordRegex.test($('#newPass').val())) {
                $('#error_newPass').show();
                $('#error_newPass').addClass('invalid-feedback');
                $('#error_newPass').removeClass('valid-feedback');
                $('#newPass').addClass('is-invalid');
                $('#error_newPass').text("Mật khẩu có chữ, số và kí tự!");
                checkError = true;
            }
            else if ($('#newPass').val().length == $('#oldPass').val().length) {
                $('#error_newPass').show();
                $('#error_newPass').addClass('invalid-feedback');
                $('#error_newPass').removeClass('valid-feedback');
                $('#newPass').addClass('is-invalid');
                $('#error_newPass').text("Mật khẩu mới trùng với mật khẩu cũ!");
                checkError = true;
            }
            else {
                $('#error_newPass').hide();
                $('#newPass').addClass('is-valid');
                $('#newPass').removeClass('is-invalid');
                checkError = false;
            }
        }
        $('#newPass').keyup(() => {
            errorNewPass();
            errorConfirmPass();
        });
        $('#newPass').keydown(() => {
            errorNewPass();
            errorConfirmPass();
        });
        const errorOldPass = () => {
            if ($('#oldPass').val() == '') {
                $('#error_oldPass').show();
                $('#error_oldPass').addClass('invalid-feedback');
                $('#error_oldPass').removeClass('valid-feedback');
                $('#oldPass').addClass('is-invalid');
                $('#error_oldPass').text("Mật khẩu cũ không được để trống!");
                checkError = true;
            }
            else {
                $('#error_oldPass').hide();
                $('#oldPass').addClass('is-valid');
                $('#oldPass').removeClass('is-invalid');
                checkError = false;
            }
        }
        $('#oldPass').keyup(() => {
            errorOldPass();
            CheckPassword();
        });
        $('#oldPass').keydown(() => {
            errorOldPass();
        });

        const errorEmail = () => {
            if ($('#Email').val() != '' && !emailRegex.test($('#Email').val())) {
                $('#error_email').show();
                $('#error_email').addClass('invalid-feedback');
                $('#error_email').removeClass('valid-feedback');
                $('#Email').addClass('is-invalid');
                $('#error_email').text("Email không đúng định dạng!");
                checkError = true;
            } else if ($('#Email').val() != '') {
                $('#error_email').hide();
                $('#Email').addClass('is-valid');
                $('#Email').removeClass('is-invalid');
                checkError = false;
            }
        }
        $('#Email').keyup(() => {
            errorEmail();
        });
        $('#Email').keydown(() => {
            errorEmail();
        });
        const errorPhone = () => {
            if ($('#Phone').val() != '' && $('#Phone').val().length != 10) {
                $('#error_phone').show();
                $('#error_phone').addClass('invalid-feedback');
                $('#error_phone').removeClass('valid-feedback');
                $('#Phone').addClass('is-invalid');
                $('#error_phone').text("SĐT có 10 số!");
                checkError = true;
            }
            else if ($('#Phone').val() != '' && !phoneRegex.test($('#Phone').val())) {
                $('#error_phone').show();
                $('#error_phone').addClass('invalid-feedback');
                $('#error_phone').removeClass('valid-feedback');
                $('#Phone').addClass('is-invalid');
                $('#error_phone').text("SĐT không đúng định dạng!");
                checkError = true;
            } else if ($('#Phone').val() != '') {
                $('#error_phone').hide();
                $('#Phone').addClass('is-valid');
                $('#Phone').removeClass('is-invalid');
                checkError = false;
            }
        }
        $('#Phone').keyup(() => {
            errorPhone();
        });
        $('#Phone').keydown(() => {
            errorPhone();
        });

        const errorAvatar = () => {
            if ($('#Avatar').get(0).files.length == 0) {
                $('#error_avatar').show();
                $('#error_avatar').addClass('invalid-feedback');
                $('#error_avatar').removeClass('valid-feedback');
                $('#Avatar').addClass('is-invalid');
                $('#error_avatar').text("Ảnh dại diện không được để trống");
                checkError = true;
            } else {
                $('#error_avatar').hide();
                $('#Avatar').addClass('is-valid');
                $('#Avatar').removeClass('is-invalid');
                checkError = false;
            }
        }

    </script>

}
